
# Инструкция по тестированию квеста с разветвлениями

## Подготовка

1. Убедитесь, что сервер запущен на порту 8080
2. Откройте Postman

## Шаг 1: Создание квеста

**Метод:** POST  
**URL:** `http://localhost:8080/make_quest`  
**Headers:** `Content-Type: application/json`

**Body:** Используйте содержимое файла `test_quest.json`

Сохраните ответ - квест должен получить ID = 1.

## Шаг 2: Создание мультиплеерного сервера

**Метод:** POST  
**URL:** `http://localhost:8080/create_server`  
**Headers:** `Content-Type: application/json`

**Body:**
```json
{
    "quest_id": 1,
    "server_name": "Тест разветвлений",
    "player_name": "Алиса"
}
```

Сохраните `server_id` из ответа (обычно 1).

## Шаг 3: Добавление второго игрока

**Метод:** POST  
**URL:** `http://localhost:8080/join_server`  
**Headers:** `Content-Type: application/json`

**Body:**
```json
{
    "server_id": 1,
    "player_name": "Боб"
}
```

## Шаг 4: Проверка начального состояния

**Метод:** GET  
**URL:** `http://localhost:8080/get_multiplayer_dialog?server_id=1`

Должен показать нарративный шаг с описанием замка.

## Шаг 5: Переход через нарративный шаг

**Метод:** POST  
**URL:** `http://localhost:8080/proceed_to_next_step`  
**Headers:** `Content-Type: application/json`

**Body:**
```json
{
    "server_id": 1
}
```

## Шаг 6: Проверка шага с выбором

**Метод:** GET  
**URL:** `http://localhost:8080/get_multiplayer_dialog?server_id=1`

Теперь должны появиться варианты выбора для каждого игрока.

## Тестирование разветвления 1: Мирный путь

### Шаг 7: Алиса выбирает мирный подход

**Метод:** POST  
**URL:** `http://localhost:8080/make_multiplayer_choice`  
**Headers:** `Content-Type: application/json`

**Body:**
```json
{
    "server_id": 1,
    "player_name": "Алиса",
    "choice_id": 2
}
```
(ID 2 = "Громко постучать в ворота")

### Шаг 8: Боб выбирает мирный подход

**Body:**
```json
{
    "server_id": 1,
    "player_name": "Боб",
    "choice_id": 4
}
```
(ID 4 = "Осмотреть местность")

### Шаг 9: Проверка результата

**Метод:** GET  
**URL:** `http://localhost:8080/get_multiplayer_dialog?server_id=1`

**Ожидаемый результат:** Страж должен дать дружелюбную реакцию, и квест пойдет по мирному пути.

## Тестирование разветвления 2: Агрессивный путь

Создайте новый сервер и повторите шаги 2-6, но с другими именами игроков.

### Агрессивные выборы:

- Игрок 1: choice_id = 1 ("Попытаться взломать замок")
- Игрок 2: choice_id = 3 ("Пролезть через пролом")

**Ожидаемый результат:** Страж должен стать враждебным, и появится темный маг.

## Проверка системы очков

После каждого выбора проверяйте изменение очков:
- `violence_point` - за агрессивные действия
- `whatever_point` - за нейтральные действия  
- `pacifism_point` - за мирные действия

## Проверка переходов между шагами

Убедитесь, что:
1. `next_step_number` в character_action правильно работает
2. Разные выборы ведут к разным шагам
3. Финальные шаги соответствуют принятым решениям

## Возможные проблемы

1. **Ошибка 404:** Убедитесь, что сервер запущен
2. **Неверные ID:** Проверьте, что используете правильные ID выборов
3. **Нет реакции персонажа:** Проверьте условия в character_action_choice

## Структура разветвлений в квесте

```
Шаг 1: Нарративный (описание замка)
   ↓
Шаг 2: Выбор игроков (как войти в замок)
   ↓
Шаг 3: Реакция Стража (зависит от очков)
   ├─ Мирная (0 насилия, 2+ пацифизм) → Шаг 5 → Хороший финал
   ├─ Нейтральная (1 насилие, 1 все) → Шаг 4 → Диалог → Призрак → Хороший финал  
   └─ Агрессивная (3+ насилие) → Шаг 7 → Темный маг → Плохой финал
```

Этот квест демонстрирует все возможности системы разветвлений.
